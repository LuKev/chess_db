groups:
  - name: chessdb-alerts
    rules:
      - alert: ChessDbApiP95LatencyHigh
        expr: |
          histogram_quantile(
            0.95,
            sum(rate(chessdb_api_request_duration_seconds_bucket[5m])) by (le)
          ) > 0.5
        for: 10m
        labels:
          severity: warning
        annotations:
          summary: "ChessDB API P95 latency above target"
          description: "P95 latency exceeded 500ms for at least 10 minutes."

      - alert: ChessDbQueueDepthHigh
        expr: sum(chessdb_queue_depth) > 100
        for: 10m
        labels:
          severity: warning
        annotations:
          summary: "ChessDB queue depth is high"
          description: "Combined queue depth has remained above 100 for 10 minutes."

      - alert: ChessDbWorkerJobFailures
        expr: sum(rate(chessdb_worker_jobs_total{status="failed"}[5m])) > 0.1
        for: 10m
        labels:
          severity: critical
        annotations:
          summary: "ChessDB worker failure rate elevated"
          description: "Worker job failure rate is above 0.1 jobs/second for 10 minutes."
